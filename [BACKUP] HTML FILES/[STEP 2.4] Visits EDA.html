<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Exploratory Data Analysis of Visits.csv</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="[STEP 2.4] Visits EDA_files/libs/clipboard/clipboard.min.js"></script>
<script src="[STEP 2.4] Visits EDA_files/libs/quarto-html/quarto.js"></script>
<script src="[STEP 2.4] Visits EDA_files/libs/quarto-html/popper.min.js"></script>
<script src="[STEP 2.4] Visits EDA_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="[STEP 2.4] Visits EDA_files/libs/quarto-html/anchor.min.js"></script>
<link href="[STEP 2.4] Visits EDA_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="[STEP 2.4] Visits EDA_files/libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="[STEP 2.4] Visits EDA_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="[STEP 2.4] Visits EDA_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="[STEP 2.4] Visits EDA_files/libs/bootstrap/bootstrap-8a79a254b8e706d3c925cde0a310d4f0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exploratory Data Analysis of Visits.csv</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="loading-the-libraries-and-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-libraries-and-the-dataset">1) Loading the libraries and the dataset</h2>
<div id="cell-3" class="cell" data-execution_count="905">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> grafici</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dython.nominal <span class="im">import</span> associations</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-4" class="cell" data-execution_count="906">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read the data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>visits <span class="op">=</span> pd.read_csv(<span class="st">'./Cleaned_Data/visits.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prepare-the-data" class="level2">
<h2 class="anchored" data-anchor-id="prepare-the-data">2) Prepare the data</h2>
<div id="cell-6" class="cell" data-execution_count="907">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert start_timestamp and end_timestamp to datetime</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'start_timestamp'</span>] <span class="op">=</span> pd.to_datetime(visits[<span class="st">'start_timestamp'</span>])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'end_timestamp'</span>] <span class="op">=</span> pd.to_datetime(visits[<span class="st">'end_timestamp'</span>])</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print the oldest and the newest date</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Oldest date:'</span>, visits[<span class="st">'start_timestamp'</span>].<span class="bu">min</span>())</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Newest date:'</span>, visits[<span class="st">'start_timestamp'</span>].<span class="bu">max</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Oldest date: 2020-06-25 01:00:00
Newest date: 2024-01-30 23:00:00</code></pre>
</div>
</div>
<div id="cell-7" class="cell" data-execution_count="908">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check duplicates</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Duplicates:'</span>, visits.duplicated().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Duplicates: 0</code></pre>
</div>
</div>
<div id="cell-8" class="cell" data-execution_count="909">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print the null values</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(visits.isnull().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>visit_id                    0
customer_id                 0
start_timestamp             0
end_timestamp               0
visit_type                  0
transaction_id         363807
visit_duration_time         0
dtype: int64</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="910">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># dtypes</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>visits.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="910">
<pre><code>visit_id                       object
customer_id                    object
start_timestamp        datetime64[ns]
end_timestamp          datetime64[ns]
visit_type                     object
transaction_id                 object
visit_duration_time            object
dtype: object</code></pre>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="911">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>platform_colors <span class="op">=</span> {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Dealership'</span>: <span class="st">'blue'</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Mobile App'</span>: <span class="st">'orange'</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Website'</span>: <span class="st">'green'</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="merge-the-datasets" class="level3">
<h3 class="anchored" data-anchor-id="merge-the-datasets">2.1) Merge the datasets</h3>
<p>Given the limited amount of info that the “users.csv” have, we can add them to the visits.csv dataset</p>
<div id="cell-13" class="cell" data-execution_count="912">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load users</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>users <span class="op">=</span> pd.read_csv(<span class="st">'Cleaned_Data/users.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-14" class="cell" data-execution_count="913">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge the data on customer_id</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>visits <span class="op">=</span> pd.merge(visits, users, on<span class="op">=</span><span class="st">'customer_id'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-15" class="cell" data-execution_count="914">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>visits.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="914">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">visit_id</th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">start_timestamp</th>
<th data-quarto-table-cell-role="th">end_timestamp</th>
<th data-quarto-table-cell-role="th">visit_type</th>
<th data-quarto-table-cell-role="th">transaction_id</th>
<th data-quarto-table-cell-role="th">visit_duration_time</th>
<th data-quarto-table-cell-role="th">user_first_name</th>
<th data-quarto-table-cell-role="th">user_last_name</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">email</th>
<th data-quarto-table-cell-role="th">email_domain</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7f94232d-9cca-4893-aebe-9a267a752f87</td>
<td>de5323eb-5e01-481f-b73a-bb78af953894</td>
<td>2023-04-18 10:51:24.477465</td>
<td>2023-04-18 11:46:26.893492</td>
<td>car configuration</td>
<td>NaN</td>
<td>0 days 00:55:02.416027</td>
<td>Michele</td>
<td>Beasley</td>
<td>Female</td>
<td>michele.beasley1988@gmail.com</td>
<td>gmail.com</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>dcb32330-15b0-4fd1-b376-9b9335fee7f9</td>
<td>15dcef30-b549-447b-8809-229c9de8526b</td>
<td>2021-03-03 17:54:25.117599</td>
<td>2021-03-03 18:07:25.117599</td>
<td>viewing</td>
<td>NaN</td>
<td>0 days 00:13:00</td>
<td>Taylor</td>
<td>Becker</td>
<td>Female</td>
<td>taylor@hotmail.com</td>
<td>hotmail.com</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>8b02d675-1365-45bc-af64-61ef9e79149c</td>
<td>3b656455-1690-47d9-b7ad-9e0aaa3bb229</td>
<td>2023-07-07 13:09:00.000000</td>
<td>2023-07-07 13:19:00.000000</td>
<td>purchasing</td>
<td>d1bfe5f5-edc1-4148-8eb0-8127dd3b52c1</td>
<td>0 days 00:10:00</td>
<td>Kathryn</td>
<td>Melton</td>
<td>Female</td>
<td>kathryn.melton@gmail.com</td>
<td>gmail.com</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>bdfc7048-adc5-4da7-a37a-4f9d90cf6436</td>
<td>c583c671-2f8a-47f3-9460-bd444b1811c8</td>
<td>2023-09-14 11:25:12.820271</td>
<td>2023-09-14 12:20:15.523626</td>
<td>car configuration</td>
<td>NaN</td>
<td>0 days 00:55:02.703355</td>
<td>Tamara</td>
<td>NaN</td>
<td>Female</td>
<td>mendez@gmail.com</td>
<td>gmail.com</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2ad3a1e1-0b9c-417f-95f7-70607b0fe96e</td>
<td>da8268d8-4e81-4538-bf1d-836ac4d5b155</td>
<td>2020-12-04 19:15:41.833927</td>
<td>2020-12-04 19:27:41.833927</td>
<td>car configuration</td>
<td>NaN</td>
<td>0 days 00:12:00</td>
<td>Kimberly</td>
<td>Davis</td>
<td>Female</td>
<td>kimberly.davis@gmail.com</td>
<td>gmail.com</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-16" class="cell" data-execution_count="915">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># checks the null values</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(visits.isnull().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>visit_id                    0
customer_id                 0
start_timestamp             0
end_timestamp               0
visit_type                  0
transaction_id         363807
visit_duration_time         0
user_first_name          3810
user_last_name           3802
gender                      0
email                    3787
email_domain             3787
dtype: int64</code></pre>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="916">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># checks the duplicates</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Duplicates:'</span>, visits.duplicated().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Duplicates: 0</code></pre>
</div>
</div>
<div id="cell-18" class="cell" data-execution_count="917">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># checks the dtypes</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>visits.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="917">
<pre><code>visit_id                       object
customer_id                    object
start_timestamp        datetime64[ns]
end_timestamp          datetime64[ns]
visit_type                     object
transaction_id                 object
visit_duration_time            object
user_first_name                object
user_last_name                 object
gender                         object
email                          object
email_domain                   object
dtype: object</code></pre>
</div>
</div>
<div id="cell-19" class="cell" data-execution_count="918">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change the dtype of visit_duration_time in seconds</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'visit_duration_time'</span>] <span class="op">=</span> pd.to_timedelta(visits[<span class="st">'visit_duration_time'</span>]).dt.total_seconds()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-20" class="cell" data-execution_count="919">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge the data on purchase_id</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>sales <span class="op">=</span> pd.read_csv(<span class="st">'Modified_Data/sales.csv'</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only the columns needed</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>sales <span class="op">=</span> sales[[<span class="st">'transaction_id'</span>, <span class="st">'platform'</span>, <span class="st">'purchase_date'</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">'purchase_price'</span>, <span class="st">'user_review'</span>, <span class="st">'car_model'</span>, <span class="st">'fuel_type'</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>       <span class="st">'release_date'</span>, <span class="st">'price'</span>, <span class="st">'discount'</span>, <span class="st">'car_age_days'</span>]]</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>visits <span class="op">=</span> pd.merge(visits, sales, on<span class="op">=</span><span class="st">'transaction_id'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>visit_id object customer_id object start_timestamp datetime64[ns] end_timestamp datetime64[ns] visit_type object transaction_id object visit_duration_time object user_first_name object user_last_name object gender object email object</p>
<div id="cell-22" class="cell" data-execution_count="920">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>sales.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="920">
<pre><code>Index(['transaction_id', 'platform', 'purchase_date', 'purchase_price',
       'user_review', 'car_model', 'fuel_type', 'release_date', 'price',
       'discount', 'car_age_days'],
      dtype='object')</code></pre>
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="921">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>visits.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="921">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">visit_id</th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">start_timestamp</th>
<th data-quarto-table-cell-role="th">end_timestamp</th>
<th data-quarto-table-cell-role="th">visit_type</th>
<th data-quarto-table-cell-role="th">transaction_id</th>
<th data-quarto-table-cell-role="th">visit_duration_time</th>
<th data-quarto-table-cell-role="th">user_first_name</th>
<th data-quarto-table-cell-role="th">user_last_name</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">platform</th>
<th data-quarto-table-cell-role="th">purchase_date</th>
<th data-quarto-table-cell-role="th">purchase_price</th>
<th data-quarto-table-cell-role="th">user_review</th>
<th data-quarto-table-cell-role="th">car_model</th>
<th data-quarto-table-cell-role="th">fuel_type</th>
<th data-quarto-table-cell-role="th">release_date</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">discount</th>
<th data-quarto-table-cell-role="th">car_age_days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7f94232d-9cca-4893-aebe-9a267a752f87</td>
<td>de5323eb-5e01-481f-b73a-bb78af953894</td>
<td>2023-04-18 10:51:24.477465</td>
<td>2023-04-18 11:46:26.893492</td>
<td>car configuration</td>
<td>NaN</td>
<td>3302.416027</td>
<td>Michele</td>
<td>Beasley</td>
<td>Female</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>dcb32330-15b0-4fd1-b376-9b9335fee7f9</td>
<td>15dcef30-b549-447b-8809-229c9de8526b</td>
<td>2021-03-03 17:54:25.117599</td>
<td>2021-03-03 18:07:25.117599</td>
<td>viewing</td>
<td>NaN</td>
<td>780.000000</td>
<td>Taylor</td>
<td>Becker</td>
<td>Female</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>8b02d675-1365-45bc-af64-61ef9e79149c</td>
<td>3b656455-1690-47d9-b7ad-9e0aaa3bb229</td>
<td>2023-07-07 13:09:00.000000</td>
<td>2023-07-07 13:19:00.000000</td>
<td>purchasing</td>
<td>d1bfe5f5-edc1-4148-8eb0-8127dd3b52c1</td>
<td>600.000000</td>
<td>Kathryn</td>
<td>Melton</td>
<td>Female</td>
<td>...</td>
<td>Dealership</td>
<td>2023-07-07</td>
<td>30000.0</td>
<td>3.0</td>
<td>1 Series</td>
<td>Diesel</td>
<td>2010-10-01</td>
<td>30000.0</td>
<td>0.0</td>
<td>4662.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>bdfc7048-adc5-4da7-a37a-4f9d90cf6436</td>
<td>c583c671-2f8a-47f3-9460-bd444b1811c8</td>
<td>2023-09-14 11:25:12.820271</td>
<td>2023-09-14 12:20:15.523626</td>
<td>car configuration</td>
<td>NaN</td>
<td>3302.703355</td>
<td>Tamara</td>
<td>NaN</td>
<td>Female</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2ad3a1e1-0b9c-417f-95f7-70607b0fe96e</td>
<td>da8268d8-4e81-4538-bf1d-836ac4d5b155</td>
<td>2020-12-04 19:15:41.833927</td>
<td>2020-12-04 19:27:41.833927</td>
<td>car configuration</td>
<td>NaN</td>
<td>720.000000</td>
<td>Kimberly</td>
<td>Davis</td>
<td>Female</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>5 rows × 22 columns</p>
</div>
</div>
</div>
</section>
<section id="feature-engineering" class="level3">
<h3 class="anchored" data-anchor-id="feature-engineering">2.2) Feature engineering</h3>
<div id="cell-25" class="cell" data-execution_count="922">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a new column with the month and the year "2020-08" (useful for the analysis)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'month_year'</span>] <span class="op">=</span> visits[<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-26" class="cell" data-execution_count="923">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add a boolean based on the presence of a purchase "transaction_id"</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'purchased'</span>] <span class="op">=</span> visits[<span class="st">'transaction_id'</span>].notnull()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-27" class="cell" data-execution_count="924">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the average visit time back to the original dataframe</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'average_visit_time'</span>] <span class="op">=</span> visits[<span class="st">'customer_id'</span>].<span class="bu">map</span>(visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'visit_duration_time'</span>].mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-28" class="cell" data-execution_count="925">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add for every customer the visit number based on the start_timestamp</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'visit_number'</span>] <span class="op">=</span> visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'start_timestamp'</span>].rank(method<span class="op">=</span><span class="st">'first'</span>, ascending<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-29" class="cell" data-execution_count="926">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crate a new column that is true if the customer has leaved a review</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'reviewed'</span>] <span class="op">=</span> visits[<span class="st">'user_review'</span>].notnull()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-30" class="cell" data-execution_count="927">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a column that contains the string visit_type to visit_type if the same user has visited more than once and the visit type is different, do this based on the start_timestamp</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sort the dataframe by customer_id and start_timestamp</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>visits <span class="op">=</span> visits.sort_values(by<span class="op">=</span>[<span class="st">'customer_id'</span>, <span class="st">'start_timestamp'</span>])</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create the switch_type column</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'switch_type'</span>] <span class="op">=</span> visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'visit_type'</span>].shift() <span class="op">+</span> <span class="st">' to '</span> <span class="op">+</span> visits[<span class="st">'visit_type'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-31" class="cell" data-execution_count="928">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print the count of the switch_type</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'switch_type'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="928">
<pre><code>switch_type
viewing to viewing                        76820
viewing to purchasing                     46875
testing to testing                        40191
car configuration to viewing              23576
viewing to car configuration              22308
testing to viewing                        17402
viewing to testing                        16896
purchasing to viewing                     14463
testing to purchasing                     13482
car configuration to car configuration     9935
car configuration to purchasing            9896
purchasing to car configuration            7640
testing to car configuration               1566
car configuration to testing               1361
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="cell-32" class="cell" data-execution_count="929">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show the customers that have the switch_type "purchasing to viewing"</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>visits[visits[<span class="st">'switch_type'</span>] <span class="op">==</span> <span class="st">'purchasing to viewing'</span>].head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="929">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">visit_id</th>
<th data-quarto-table-cell-role="th">customer_id</th>
<th data-quarto-table-cell-role="th">start_timestamp</th>
<th data-quarto-table-cell-role="th">end_timestamp</th>
<th data-quarto-table-cell-role="th">visit_type</th>
<th data-quarto-table-cell-role="th">transaction_id</th>
<th data-quarto-table-cell-role="th">visit_duration_time</th>
<th data-quarto-table-cell-role="th">user_first_name</th>
<th data-quarto-table-cell-role="th">user_last_name</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">release_date</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">discount</th>
<th data-quarto-table-cell-role="th">car_age_days</th>
<th data-quarto-table-cell-role="th">month_year</th>
<th data-quarto-table-cell-role="th">purchased</th>
<th data-quarto-table-cell-role="th">average_visit_time</th>
<th data-quarto-table-cell-role="th">visit_number</th>
<th data-quarto-table-cell-role="th">reviewed</th>
<th data-quarto-table-cell-role="th">switch_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">53896</td>
<td>e0cf90eb-acd2-448c-8dfe-649bd29da418</td>
<td>00025afa-8bb4-41da-808b-4d31a09d8768</td>
<td>2023-11-03 08:44:59.877969</td>
<td>2023-11-03 09:40:08.938905</td>
<td>viewing</td>
<td>NaN</td>
<td>3309.060936</td>
<td>Anita</td>
<td>Maddox</td>
<td>Female</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2023-11</td>
<td>False</td>
<td>2807.265234</td>
<td>4.0</td>
<td>False</td>
<td>purchasing to viewing</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">170567</td>
<td>7cb506f0-0078-4893-9cf9-198b4edf3b44</td>
<td>00039e36-b5c3-4019-82ca-b6891f1b3198</td>
<td>2022-08-10 09:28:15.178155</td>
<td>2022-08-10 10:23:16.207613</td>
<td>viewing</td>
<td>NaN</td>
<td>3301.029458</td>
<td>Jennifer</td>
<td>Martinez</td>
<td>Female</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2022-08</td>
<td>False</td>
<td>2629.341394</td>
<td>4.0</td>
<td>False</td>
<td>purchasing to viewing</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">281165</td>
<td>0e409a10-9839-44c3-a53c-b9e5d1504650</td>
<td>000c1d19-cce3-42f7-b62e-154d5e1c0c55</td>
<td>2023-11-08 10:16:47.705479</td>
<td>2023-11-08 11:11:59.961564</td>
<td>viewing</td>
<td>NaN</td>
<td>3312.256085</td>
<td>Jennifer</td>
<td>Chavez</td>
<td>Female</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2023-11</td>
<td>False</td>
<td>1504.085362</td>
<td>3.0</td>
<td>False</td>
<td>purchasing to viewing</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">85008</td>
<td>0955b658-c88e-42cd-872f-9b1206717c7e</td>
<td>00164252-bfae-4f44-b6ae-76c211993a75</td>
<td>2023-11-01 11:19:43.148627</td>
<td>2023-11-01 12:14:44.399970</td>
<td>viewing</td>
<td>NaN</td>
<td>3301.251343</td>
<td>Lori</td>
<td>Williams</td>
<td>Female</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2023-11</td>
<td>False</td>
<td>2740.417114</td>
<td>3.0</td>
<td>False</td>
<td>purchasing to viewing</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8330</td>
<td>7b48edf3-4720-4269-a08d-cfaa5f878df8</td>
<td>001a6022-f75c-4e5b-9496-dcfa03ebf611</td>
<td>2023-12-10 09:18:16.242659</td>
<td>2023-12-10 10:13:24.542969</td>
<td>viewing</td>
<td>NaN</td>
<td>3308.300310</td>
<td>Kevin</td>
<td>Burke</td>
<td>Male</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2023-12</td>
<td>False</td>
<td>2074.150155</td>
<td>2.0</td>
<td>False</td>
<td>purchasing to viewing</td>
</tr>
</tbody>
</table>

<p>5 rows × 28 columns</p>
</div>
</div>
</div>
<p>Ok, that makes sense.</p>
<div id="cell-34" class="cell" data-execution_count="930">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if the switch_type is "viewing to something" create a column that contains a bool value "Engaged" (except viewing to viewing)</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'engaged'</span>] <span class="op">=</span> visits[<span class="st">'switch_type'</span>].fillna(<span class="st">''</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.startswith(<span class="st">'viewing to'</span>) <span class="kw">and</span> x <span class="op">!=</span> <span class="st">'viewing to viewing'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-35" class="cell" data-execution_count="931">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a column for the customer loyalty (time between the first and the last visit) in days as an integer</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'loyalty'</span>] <span class="op">=</span> visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'start_timestamp'</span>].transform(<span class="kw">lambda</span> x: (x.<span class="bu">max</span>() <span class="op">-</span> x.<span class="bu">min</span>()).days)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-36" class="cell" data-execution_count="932">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># impute the platform, group by the user_id if the start_timestamp is in the same week</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'platform'</span>] <span class="op">=</span> visits[<span class="st">'platform'</span>].fillna(visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'platform'</span>].transform(<span class="st">'first'</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># with the same logic impute the purchase_date, purchase_price, user_review, car_model, fuel_type, release_date, price, discount, car_age_days</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'purchase_date'</span>] <span class="op">=</span> visits[<span class="st">'purchase_date'</span>].fillna(visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'purchase_date'</span>].transform(<span class="st">'first'</span>))</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'purchase_price'</span>] <span class="op">=</span> visits[<span class="st">'purchase_price'</span>].fillna(visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'purchase_price'</span>].transform(<span class="st">'first'</span>))</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'user_review'</span>] <span class="op">=</span> visits[<span class="st">'user_review'</span>].fillna(visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'user_review'</span>].transform(<span class="st">'first'</span>))</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'car_model'</span>] <span class="op">=</span> visits[<span class="st">'car_model'</span>].fillna(visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'car_model'</span>].transform(<span class="st">'first'</span>))</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'fuel_type'</span>] <span class="op">=</span> visits[<span class="st">'fuel_type'</span>].fillna(visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'fuel_type'</span>].transform(<span class="st">'first'</span>))</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'price'</span>] <span class="op">=</span> visits[<span class="st">'price'</span>].fillna(visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'price'</span>].transform(<span class="st">'first'</span>))</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'discount'</span>] <span class="op">=</span> visits[<span class="st">'discount'</span>].fillna(visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'discount'</span>].transform(<span class="st">'first'</span>))</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'car_age_days'</span>] <span class="op">=</span> visits[<span class="st">'car_age_days'</span>].fillna(visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'car_age_days'</span>].transform(<span class="st">'first'</span>))</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>visits[<span class="st">'user_review'</span>] <span class="op">=</span> visits[<span class="st">'user_review'</span>].fillna(visits.groupby(<span class="st">'customer_id'</span>)[<span class="st">'user_review'</span>].transform(<span class="st">'first'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can make this assumption because only two users bought a car twice. Therefore, we assume that users who made a purchase visited the same platform before buying and for the same car.</p>
<div id="cell-38" class="cell" data-execution_count="933">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>visits.isna().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="933">
<pre><code>visit_id                    0
customer_id                 0
start_timestamp             0
end_timestamp               0
visit_type                  0
transaction_id         363807
visit_duration_time         0
user_first_name          3810
user_last_name           3802
gender                      0
email                    3787
email_domain             3787
platform               125546
purchase_date          125546
purchase_price         125546
user_review            398264
car_model              125546
fuel_type              125546
release_date           363807
price                  125546
discount               125546
car_age_days           125546
month_year                  0
purchased                   0
average_visit_time          0
visit_number                0
reviewed                    0
switch_type            136176
engaged                     0
loyalty                     0
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="associations" class="level3">
<h3 class="anchored" data-anchor-id="associations">2.2) Associations</h3>
<div id="cell-40" class="cell" data-execution_count="934">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>visits_dython <span class="op">=</span> visits.copy()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create a column for only the "Dealership" category in the platform column</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>visits_dython[<span class="st">'Dealership'</span>] <span class="op">=</span> visits_dython[<span class="st">'platform'</span>] <span class="op">==</span> <span class="st">'Dealership'</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print all the column that have id in the name</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>id_columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> visits_dython.columns <span class="cf">if</span> <span class="st">'_id'</span> <span class="kw">in</span> col]</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"We are dropping the following columns:"</span>, id_columns)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>visits_dython.drop(columns<span class="op">=</span>id_columns, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>We are dropping the following columns: ['visit_id', 'customer_id', 'transaction_id']</code></pre>
</div>
</div>
<div id="cell-41" class="cell" data-execution_count="935">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>visits_dython[<span class="st">"month_year"</span>] <span class="op">=</span> visits_dython[<span class="st">"month_year"</span>].astype(<span class="bu">str</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-42" class="cell" data-execution_count="936">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>associations_visits <span class="op">=</span> associations(visits_dython, multiprocessing<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'gnuplot'</span>, num_num_assoc<span class="op">=</span><span class="st">'spearman'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\gabri\AppData\Local\Programs\Python\Python311\Lib\site-packages\dython\nominal.py:632: FutureWarning: Series.view is deprecated and will be removed in a future version. Use ``astype`` as an alternative to change the dtype.
  lambda col: col.view(np.int64), axis=0</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-33-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Seems that the Dealership has a strong correlation wit a lot of different features, the ones that we were expecting are: the purchase bool, the platform type and the user review</p>
<p>The associations that we weren’t expecting are: the price and the visit duration time</p>
<p>It’s interesting to see how the purchase and visit type have the same association</p>
</section>
</section>
<section id="analyse-all-columns-one-by-one" class="level2">
<h2 class="anchored" data-anchor-id="analyse-all-columns-one-by-one">3) Analyse all columns one by one</h2>
<section id="id-columns" class="level3">
<h3 class="anchored" data-anchor-id="id-columns">id columns</h3>
<div id="cell-46" class="cell" data-execution_count="937">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check any strange values in the visit_id column</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="op">~</span>visits[<span class="st">'visit_id'</span>].fillna(<span class="st">''</span>).<span class="bu">str</span>.contains(<span class="vs">r'[a-z0-9]</span><span class="sc">{8}</span><span class="vs">-[a-z0-9]</span><span class="sc">{4}</span><span class="vs">-[a-z0-9]</span><span class="sc">{4}</span><span class="vs">-[a-z0-9]</span><span class="sc">{4}</span><span class="vs">-[a-z0-9]</span><span class="sc">{12}</span><span class="vs">'</span>)][<span class="st">"visit_id"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="937">
<pre><code>Series([], Name: count, dtype: int64)</code></pre>
</div>
</div>
<div id="cell-47" class="cell" data-execution_count="938">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check any strange values in the customer_id column</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="op">~</span>visits[<span class="st">'customer_id'</span>].fillna(<span class="st">''</span>).<span class="bu">str</span>.contains(<span class="vs">r'[a-z0-9]</span><span class="sc">{8}</span><span class="vs">-[a-z0-9]</span><span class="sc">{4}</span><span class="vs">-[a-z0-9]</span><span class="sc">{4}</span><span class="vs">-[a-z0-9]</span><span class="sc">{4}</span><span class="vs">-[a-z0-9]</span><span class="sc">{12}</span><span class="vs">'</span>)][<span class="st">"customer_id"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="938">
<pre><code>Series([], Name: count, dtype: int64)</code></pre>
</div>
</div>
<div id="cell-48" class="cell" data-execution_count="939">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check any strange values in the customer_id column</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>visits[<span class="op">~</span>visits[<span class="st">'transaction_id'</span>].fillna(<span class="st">''</span>).<span class="bu">str</span>.contains(<span class="vs">r'[a-z0-9]</span><span class="sc">{8}</span><span class="vs">-[a-z0-9]</span><span class="sc">{4}</span><span class="vs">-[a-z0-9]</span><span class="sc">{4}</span><span class="vs">-[a-z0-9]</span><span class="sc">{4}</span><span class="vs">-[a-z0-9]</span><span class="sc">{12}</span><span class="vs">'</span>)][<span class="st">"transaction_id"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="939">
<pre><code>Series([], Name: count, dtype: int64)</code></pre>
</div>
</div>
<div id="cell-49" class="cell" data-execution_count="940">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check duplicates on visit_id</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Duplicates:'</span>, visits[<span class="st">'visit_id'</span>].duplicated().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Duplicates: 0</code></pre>
</div>
</div>
<div id="cell-50" class="cell" data-execution_count="941">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check duplicates on transaction_id where is not null</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Duplicates:'</span>, visits[visits[<span class="st">'transaction_id'</span>].notnull()][<span class="st">'transaction_id'</span>].duplicated().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Duplicates: 0</code></pre>
</div>
</div>
<div id="cell-51" class="cell" data-execution_count="942">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check duplicates on customer_id (we expect duplicates)</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Duplicates:'</span>, visits[<span class="st">'customer_id'</span>].duplicated().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Duplicates: 302411</code></pre>
</div>
</div>
<div id="cell-52" class="cell" data-execution_count="943">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print the top 5 customers with the most visits</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(visits[<span class="st">'customer_id'</span>].value_counts().head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>customer_id
db1482ff-1a20-43c0-94c5-bcacba70d5ea    17
baf07990-e4c0-4b45-8d74-1dd054073fc2    15
40a8e90c-7b08-4958-9135-0d76684c922c    15
bd57c252-55a7-47c4-915f-572db31439cb    14
88617f81-5147-4b1a-a556-6731e76e1d1c    13
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="start-timestamp-column" class="level3">
<h3 class="anchored" data-anchor-id="start-timestamp-column">Start timestamp column</h3>
<div id="cell-54" class="cell" data-execution_count="944">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the first and the last start timestamp</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Oldest date:'</span>, visits[<span class="st">'start_timestamp'</span>].<span class="bu">min</span>())</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Newest date:'</span>, visits[<span class="st">'start_timestamp'</span>].<span class="bu">max</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Oldest date: 2020-06-25 01:00:00
Newest date: 2024-01-30 23:00:00</code></pre>
</div>
</div>
<div id="cell-55" class="cell" data-execution_count="974">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a figure and axis</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the bar chart</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>monthly_visits <span class="op">=</span> visits[<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>).value_counts().sort_index()</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>ax.bar(monthly_visits.index.astype(<span class="bu">str</span>), monthly_visits.values, label<span class="op">=</span><span class="st">'Monthly Visits'</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the line chart</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>ax.plot(monthly_visits.index.astype(<span class="bu">str</span>), monthly_visits.rolling(window<span class="op">=</span><span class="dv">3</span>).mean().values, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Visits Trend'</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co"># adding the purchase line</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>monthly_purchases <span class="op">=</span> visits[visits[<span class="st">'purchased'</span>]][<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>).value_counts().sort_index()</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>ax.plot(monthly_purchases.index.astype(<span class="bu">str</span>), monthly_purchases.values, color<span class="op">=</span><span class="st">'lime'</span>, label<span class="op">=</span><span class="st">'Purchases'</span>)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="co"># set the labels and title</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Month-Year'</span>)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Number of Visits'</span>)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Monthly Visits Trend'</span>)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="co"># rotate x-axis labels for better readability</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">75</span>)</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="co"># add a legend</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a><span class="co"># show the plot</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Really interesting, the trend is exatly what we want</p>
<p>The number of purchases needs more investigation</p>
<section id="number-of-customers-per-month-by-platform" class="level5">
<h5 class="anchored" data-anchor-id="number-of-customers-per-month-by-platform">Number of Customers per Month by Platform</h5>
<div id="cell-58" class="cell" data-execution_count="946">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by month_year and platform, and count the number of unique customers</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>monthly_customers <span class="op">=</span> visits.groupby([<span class="st">'month_year'</span>, <span class="st">'platform'</span>])[<span class="st">'customer_id'</span>].nunique().unstack()</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and axis</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the number of customers per month by platform</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>monthly_customers.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the labels and title</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Month-Year'</span>)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Number of Customers'</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Number of Customers per Month by Platform'</span>)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate x-axis labels for better readability</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">75</span>)</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a legend</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>ax.legend(title<span class="op">=</span><span class="st">'Platform'</span>)</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-43-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="end-timestamp-column" class="level3">
<h3 class="anchored" data-anchor-id="end-timestamp-column">End timestamp column</h3>
<div id="cell-60" class="cell" data-execution_count="947">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot when the end_timestamp is smaller than the start_timestamp</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histogram</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>ax.bar(x <span class="op">=</span>      visits[visits[<span class="st">'end_timestamp'</span>] <span class="op">&lt;</span> visits[<span class="st">'start_timestamp'</span>]].groupby(visits[<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>)).size().index.astype(<span class="bu">str</span>), </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>       height <span class="op">=</span> visits[visits[<span class="st">'end_timestamp'</span>] <span class="op">&lt;</span> visits[<span class="st">'start_timestamp'</span>]].groupby(visits[<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>)).size().values)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co"># set the labels and title</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Month-Year'</span>)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Number of Visits'</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Visits with End Timestamp Smaller than Start Timestamp'</span>)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="co"># rotate x-axis labels for better readability</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">75</span>)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="co"># show the plot</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-44-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It seems fine, from now on we’re going to base our analysis on the start datetime</p>
</section>
<section id="visit-duration-seconds" class="level3">
<h3 class="anchored" data-anchor-id="visit-duration-seconds">Visit duration seconds</h3>
<div id="cell-63" class="cell" data-execution_count="948">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># box plot of the visit_duration_time by platform</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the boxplot</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>visits.boxplot(column<span class="op">=</span><span class="st">'visit_duration_time'</span>, by<span class="op">=</span><span class="st">'platform'</span>, ax<span class="op">=</span>ax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-45-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="average-visit-time-vs-purchase-likelihood" class="level4">
<h4 class="anchored" data-anchor-id="average-visit-time-vs-purchase-likelihood">Average Visit Time vs Purchase Likelihood</h4>
<div id="cell-65" class="cell" data-execution_count="975">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># box plot of the visit_duration_time by purchase</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the boxplot</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>visits.boxplot(column<span class="op">=</span><span class="st">'visit_duration_time'</span>, by<span class="op">=</span><span class="st">'purchased'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Visit Duration Time by Purchase'</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">''</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Purchased'</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Visit Duration Time'</span>)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-46-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It appears that users who spend an excessive amount of time on the platform tend to lose interest in purchasing a car. <br>This insight is interesting and suggests potential areas for improvement. <br>Implementing an AI assistant for real-time user questions or sending follow-up emails with special discounts to users who did not complete a purchase could improve engagement and conversion rates.</p>
</section>
<section id="monthly-average-visit-duration" class="level4">
<h4 class="anchored" data-anchor-id="monthly-average-visit-duration">Monthly Average Visit Duration</h4>
<div id="cell-68" class="cell" data-execution_count="950">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the visit_duration_time distribution by month and year</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histogram</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>monthly_duration <span class="op">=</span> visits.groupby(visits[<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>))[<span class="st">'visit_duration_time'</span>].mean()</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>ax.bar(monthly_duration.index.astype(<span class="bu">str</span>), monthly_duration.values, color<span class="op">=</span><span class="st">'lightblue'</span>, alpha<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot a line for every platform</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> platform <span class="kw">in</span> visits[<span class="st">'platform'</span>].unique():</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    monthly_duration <span class="op">=</span> visits[visits[<span class="st">'platform'</span>] <span class="op">==</span> platform].groupby(visits[<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>))[<span class="st">'visit_duration_time'</span>].mean()</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(monthly_duration.index.astype(<span class="bu">str</span>), monthly_duration.values, label<span class="op">=</span>platform)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="co"># set the labels and title</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Month-Year'</span>)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Average Visit Duration (Seconds)'</span>)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Monthly Average Visit Duration'</span>)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="co"># rotate x-axis labels for better readability</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">75</span>)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add a legend</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="co"># show a grid</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a><span class="co"># show the plot</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-47-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It can be observed that in June 2020, the average visit duration was unusually high. <br>From November 2020 (the historical minimum), the trend reversed, and January 2024 is the month with the highest average duration. <br>The trend suggests that something happened recently that significantly increased the average visit duration.</p>
<div id="cell-70" class="cell" data-execution_count="951">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the null values</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>visits.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="951">
<pre><code>visit_id                    0
customer_id                 0
start_timestamp             0
end_timestamp               0
visit_type                  0
transaction_id         363807
visit_duration_time         0
user_first_name          3810
user_last_name           3802
gender                      0
email                    3787
email_domain             3787
platform               125546
purchase_date          125546
purchase_price         125546
user_review            398264
car_model              125546
fuel_type              125546
release_date           363807
price                  125546
discount               125546
car_age_days           125546
month_year                  0
purchased                   0
average_visit_time          0
visit_number                0
reviewed                    0
switch_type            136176
engaged                     0
loyalty                     0
dtype: int64</code></pre>
</div>
</div>
<div id="cell-71" class="cell" data-execution_count="952">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of nans</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(visits.isnull().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>visit_id                    0
customer_id                 0
start_timestamp             0
end_timestamp               0
visit_type                  0
transaction_id         363807
visit_duration_time         0
user_first_name          3810
user_last_name           3802
gender                      0
email                    3787
email_domain             3787
platform               125546
purchase_date          125546
purchase_price         125546
user_review            398264
car_model              125546
fuel_type              125546
release_date           363807
price                  125546
discount               125546
car_age_days           125546
month_year                  0
purchased                   0
average_visit_time          0
visit_number                0
reviewed                    0
switch_type            136176
engaged                     0
loyalty                     0
dtype: int64</code></pre>
</div>
</div>
</section>
</section>
<section id="visit-type-column" class="level3">
<h3 class="anchored" data-anchor-id="visit-type-column">Visit type column</h3>
<div id="cell-73" class="cell" data-execution_count="953">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the distribution of the visit_type</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histogram</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>visit_type <span class="op">=</span> visits[<span class="st">'visit_type'</span>].value_counts()</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>ax.bar(visit_type.index, visit_type.values)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="co"># set the labels and title</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Visit Type'</span>)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Number of Visits'</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Visit Type Distribution'</span>)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="co"># show the plot</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that there’s a lot of users that visit the website</p>
<p>Strangely the number of purchasing is bigger than the car configuration one, that’s really strange</p>
<div id="cell-75" class="cell" data-execution_count="954">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter visits where visit_number is not 1 and visit_type changed from 'visit' to anything else</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>jumped_visits <span class="op">=</span> visits[(visits[<span class="st">'visit_number'</span>] <span class="op">!=</span> <span class="dv">1</span>) <span class="op">&amp;</span> (visits[<span class="st">'visit_type'</span>] <span class="op">!=</span> <span class="st">'visit'</span>)]</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>jumped_visits_count <span class="op">=</span> jumped_visits.groupby(<span class="st">'customer_id'</span>).size()</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of users who jumped from visit to anything else: </span><span class="sc">{</span>jumped_visits_count<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>percentage <span class="op">=</span> jumped_visits_count.shape[<span class="dv">0</span>] <span class="op">/</span> visits[<span class="st">'customer_id'</span>].nunique() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Percentage of users who jumped from visit to anything else: </span><span class="sc">{</span>percentage<span class="sc">:.2f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of users who jumped from visit to anything else: 100694
Percentage of users who jumped from visit to anything else: 73.94%</code></pre>
</div>
</div>
<section id="monthly-visits-by-visit-type" class="level4">
<h4 class="anchored" data-anchor-id="monthly-visits-by-visit-type">Monthly Visits by Visit Type</h4>
<div id="cell-77" class="cell" data-execution_count="955">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the number of visit_type by month and year</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histogram of total visits</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>monthly_visits <span class="op">=</span> visits[<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>).value_counts().sort_index()</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>ax.bar(monthly_visits.index.astype(<span class="bu">str</span>), monthly_visits.values, label<span class="op">=</span><span class="st">'Total Visits'</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot a line for every visit_type</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> visit_type <span class="kw">in</span> visits[<span class="st">'visit_type'</span>].unique():</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    monthly_visits <span class="op">=</span> visits[visits[<span class="st">'visit_type'</span>] <span class="op">==</span> visit_type][<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>).value_counts().sort_index()</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(monthly_visits.index.astype(<span class="bu">str</span>), monthly_visits.values, label<span class="op">=</span>visit_type)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co"># set the labels and title</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Month-Year'</span>)</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Number of Visits'</span>)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Monthly Visits by Visit Type'</span>)</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="co"># rotate x-axis labels for better readability</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">75</span>)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add a legend</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a><span class="co"># show the plot</span></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-52-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The number of customers testing cars appears to be decreasing, while the number of customers configuring cars is on a constant rise. This trend is particularly interesting because the testing option is only available at the Dealership. It demonstrates a shift in customer behavior.</p>
</section>
<section id="monthly-visits-by-visit-type-in-details" class="level4">
<h4 class="anchored" data-anchor-id="monthly-visits-by-visit-type-in-details">Monthly Visits by Visit Type (in details)</h4>
<div id="cell-80" class="cell" data-execution_count="956">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>platforms <span class="op">=</span> visits[<span class="st">'platform'</span>].unique()</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> platform <span class="kw">in</span> platforms:</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check if it's not nan</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.notnull(platform):</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># filter visits by platform</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>        platform_visits <span class="op">=</span> visits[visits[<span class="st">'platform'</span>] <span class="op">==</span> platform]</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plot the histogram of total visits</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>        monthly_visits <span class="op">=</span> platform_visits[<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>).value_counts().sort_index()</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>        ax.bar(monthly_visits.index.astype(<span class="bu">str</span>), monthly_visits.values, label<span class="op">=</span><span class="st">'Total Visits'</span>)</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># plot a line for every visit_type</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> visit_type <span class="kw">in</span> platform_visits[<span class="st">'visit_type'</span>].unique():</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>            monthly_visits <span class="op">=</span> platform_visits[platform_visits[<span class="st">'visit_type'</span>] <span class="op">==</span> visit_type][<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>).value_counts().sort_index()</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>            ax.plot(monthly_visits.index.astype(<span class="bu">str</span>), monthly_visits.values, label<span class="op">=</span>visit_type)</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># set the labels and title</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'Month-Year'</span>)</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'Number of Visits'</span>)</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="ss">f'Monthly Visits by Visit Type for </span><span class="sc">{</span>platform<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># rotate x-axis labels for better readability</span></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">75</span>)</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># show the grid</span></span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add a legend</span></span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># show the plot</span></span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-53-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-53-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The dealership’s monthly visits did not lose any growth with the introduction of the Website and the Mobile App. <br>This indicates that the dealership platform maintained its user base and continued to attract visits despite the availability of other platforms. <br>The consistent growth across all platforms suggests a robust and expanding customer engagement strategy.</p>
</section>
</section>
<section id="customer-analisys" class="level3">
<h3 class="anchored" data-anchor-id="customer-analisys">Customer analisys</h3>
<section id="engagement-rate" class="level4">
<h4 class="anchored" data-anchor-id="engagement-rate">Engagement Rate (%)</h4>
<section id="engagement-rate-visit-type" class="level5">
<h5 class="anchored" data-anchor-id="engagement-rate-visit-type">Engagement Rate (visit type)</h5>
<div id="cell-85" class="cell" data-execution_count="957">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># group by month_year and platform, and count the number of engaged customers</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>monthly_engaged <span class="op">=</span> visits[visits[<span class="st">'engaged'</span>]].groupby([<span class="st">'month_year'</span>, <span class="st">'platform'</span>])[<span class="st">'customer_id'</span>].nunique().unstack()</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>monthly_engaged.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Month-Year'</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Number of Engaged Customers'</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Number of Engaged Customers per Month by Platform'</span>)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">75</span>)</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>ax.legend(title<span class="op">=</span><span class="st">'Platform'</span>)</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> monthly_engaged</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-54-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The Dealership is clearly struggling to generate new engagement. In contrast, the Mobile App and Website are experiencing consistent growth, which is a positive trend.</p>
</section>
<section id="engagement-rate-user-review" class="level5">
<h5 class="anchored" data-anchor-id="engagement-rate-user-review">Engagement Rate (user review)</h5>
<div id="cell-88" class="cell" data-execution_count="958">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter the visits</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>reviewed_visits <span class="op">=</span> visits[visits[<span class="st">'reviewed'</span>]]</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># group by month_year and platform, and count the number of unique customers who left a review</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>monthly_reviews <span class="op">=</span> reviewed_visits.groupby([<span class="st">'month_year'</span>, <span class="st">'platform'</span>])[<span class="st">'customer_id'</span>].nunique().unstack()</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>monthly_reviews.plot(kind<span class="op">=</span><span class="st">'bar'</span>, stacked<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Month-Year'</span>)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Number of Reviews'</span>)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Number of Reviews per Month by Platform'</span>)</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">75</span>)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>ax.legend(title<span class="op">=</span><span class="st">'Platform'</span>)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> reviewed_visits</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-55-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The same pattern is observed here.</p>
</section>
</section>
<section id="conversion-rate" class="level4">
<h4 class="anchored" data-anchor-id="conversion-rate">Conversion Rate (%)</h4>
<div id="cell-91" class="cell" data-vscode="{&quot;languageId&quot;:&quot;ruby&quot;}">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> platform <span class="kw">in</span> visits[<span class="st">'platform'</span>].unique():</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.notnull(platform):</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># filter visits by platform and visit number &gt; 1</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>        platform_visits <span class="op">=</span> visits[(visits[<span class="st">'platform'</span>] <span class="op">==</span> platform) <span class="op">&amp;</span> (visits[<span class="st">'visit_number'</span>] <span class="op">&gt;</span> <span class="dv">1</span>)]</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>        purchase_percentage <span class="op">=</span> platform_visits[platform_visits[<span class="st">'purchased'</span>]].groupby(<span class="st">'month_year'</span>)[<span class="st">'customer_id'</span>].nunique() <span class="op">/</span> platform_visits[<span class="st">'customer_id'</span>].nunique() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>        purchase_percentage.plot(kind<span class="op">=</span><span class="st">'bar'</span>, ax<span class="op">=</span>ax, color<span class="op">=</span>platform_colors.get(platform, <span class="st">'gray'</span>))</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'Month-Year'</span>)</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'Conversion Rate (%)'</span>)</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="ss">f'Percentage of Purchases Over All Customers by Month-Year for </span><span class="sc">{</span>platform<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">75</span>)</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> platform_visits</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-56-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-56-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-56-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The website is the top performer and shows the most significant growth. The mobile app’s growth appears to have slowed down, while the dealership remains stable over time (no bueno).</p>
<p>This indicates that the website is performing exceptionally well, and the current strategy is effective. However, the mobile app and dealership platforms require attention to enhance their performance.</p>
<div id="cell-93" class="cell" data-execution_count="960">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># group by platform and visit duration time, then calculate the mean conversion rate</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>purchased_by_duration <span class="op">=</span> visits.groupby([<span class="st">'platform'</span>, <span class="st">'visit_duration_time'</span>])[<span class="st">'purchased'</span>].mean().reset_index()</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>purchased_by_duration, x<span class="op">=</span><span class="st">'visit_duration_time'</span>, y<span class="op">=</span><span class="st">'purchased'</span>, hue<span class="op">=</span><span class="st">'platform'</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Visit Duration Time (Seconds)'</span>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Conversion Rate'</span>)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Conversion Rate vs. Visit Duration Time by Platform'</span>)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">'Platform'</span>)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-57-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The website and the Mobile App lines are strange, let’s investigate them</p>
<div id="cell-95" class="cell" data-execution_count="961">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique platforms</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>platforms <span class="op">=</span> visits[<span class="st">'platform'</span>].unique()</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>median_visit_duration <span class="op">=</span> visits.groupby([<span class="st">'platform'</span>, <span class="st">'visit_type'</span>])[<span class="st">'visit_duration_time'</span>].median().reset_index()</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each platform and create a plot</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> platform <span class="kw">in</span> platforms:</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.notnull(platform):</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filter data for the current platform</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>        platform_data <span class="op">=</span> purchased_by_duration[purchased_by_duration[<span class="st">'platform'</span>] <span class="op">==</span> platform]</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a subplot with 2 rows and 1 column</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>        fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>), sharex<span class="op">=</span><span class="va">True</span>, gridspec_kw<span class="op">=</span>{<span class="st">'height_ratios'</span>: [<span class="dv">3</span>, <span class="dv">1</span>]})</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the lineplot on the first axis</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>        sns.lineplot(data<span class="op">=</span>platform_data, x<span class="op">=</span><span class="st">'visit_duration_time'</span>, y<span class="op">=</span><span class="st">'purchased'</span>, color<span class="op">=</span>platform_colors.get(platform, <span class="st">'gray'</span>), ax<span class="op">=</span>ax1)</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>        ax1.set_ylabel(<span class="st">'Conversion Rate'</span>)</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>        ax1.set_title(<span class="ss">f'Conversion Rate vs. Visit Duration Time for </span><span class="sc">{</span>platform<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>        ax1.grid(<span class="va">True</span>)</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add a vertical line for the median visit duration time</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>        median_duration <span class="op">=</span> median_visit_duration[median_visit_duration[<span class="st">'platform'</span>] <span class="op">==</span> platform]</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> median_duration.iterrows():</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>            ax1.axvline(x<span class="op">=</span>row[<span class="st">'visit_duration_time'</span>], color<span class="op">=</span>platform_colors.get(platform, <span class="st">'gray'</span>), linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="ss">f"Median </span><span class="sc">{</span>row[<span class="st">'visit_type'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the boxplot on the second axis</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>        sns.boxplot(data<span class="op">=</span>visits[visits[<span class="st">'platform'</span>] <span class="op">==</span> platform], x<span class="op">=</span><span class="st">'visit_duration_time'</span>, y<span class="op">=</span><span class="st">'visit_type'</span>, ax<span class="op">=</span>ax2, color<span class="op">=</span>platform_colors.get(platform, <span class="st">'gray'</span>))</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>        ax2.set_xlabel(<span class="st">'Visit Duration Time (Seconds)'</span>)</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>        ax2.set_ylabel(<span class="st">'Visit Type'</span>)</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>        ax2.grid(<span class="va">True</span>)</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Show the plot</span></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>        plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-58-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-58-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-58-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="user-loyalty" class="level4">
<h4 class="anchored" data-anchor-id="user-loyalty">User loyalty</h4>
<div id="cell-97" class="cell" data-execution_count="962">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by loyalty and calculate the purchase rate</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>loyalty_purchase_rate <span class="op">=</span> visits.groupby(<span class="st">'loyalty'</span>)[<span class="st">'purchased'</span>].mean().reset_index()</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and axis</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the loyalty vs purchase rate</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>loyalty_purchase_rate, x<span class="op">=</span><span class="st">'loyalty'</span>, y<span class="op">=</span><span class="st">'purchased'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the labels and title</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'User Loyalty (Days)'</span>)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Purchase Rate'</span>)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'User Loyalty vs Purchase Rate'</span>)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-59-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This graph shows how the loyalty doesen’t correlate in a positive manner to the purchase rate, that’s mostly because the number of customer every year grown and there are no customer that bought more than one car</p>
<div id="cell-99" class="cell" data-execution_count="963">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out rows where user_review is NaN</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>loyalty_review_data <span class="op">=</span> visits[visits[<span class="st">'user_review'</span>].notna()]</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a hexbin plot</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>plt.hexbin(loyalty_review_data[<span class="st">'loyalty'</span>], loyalty_review_data[<span class="st">'user_review'</span>], gridsize<span class="op">=</span><span class="dv">50</span>, cmap<span class="op">=</span><span class="st">'gnuplot'</span>)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the labels and title</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'User Loyalty (Days)'</span>)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'User Review'</span>)</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'User Loyalty vs User Review'</span>)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a color bar</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">'Count'</span>)</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-60-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The loyalty dosen’t seem to correlate with the user experience</p>
</section>
<section id="other-info" class="level4">
<h4 class="anchored" data-anchor-id="other-info">Other info</h4>
<div id="cell-102" class="cell" data-execution_count="964">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check if there's any unique value for the customer_id that doesn't repeat</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(visits[<span class="st">'customer_id'</span>].value_counts()[visits[<span class="st">'customer_id'</span>].value_counts() <span class="op">==</span> <span class="dv">1</span>])<span class="sc">}</span><span class="ss"> unique customers that visited only once."</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"This represents </span><span class="sc">{</span><span class="bu">len</span>(visits[<span class="st">'customer_id'</span>].value_counts()[visits[<span class="st">'customer_id'</span>].value_counts() <span class="op">==</span> <span class="dv">1</span>]) <span class="op">/</span> <span class="bu">len</span>(visits[<span class="st">'customer_id'</span>].value_counts()) <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">% of the total customers."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 35482 unique customers that visited only once.
This represents 26.06% of the total customers.</code></pre>
</div>
</div>
<div id="cell-103" class="cell" data-execution_count="965">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check how many users have a purchase</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(visits[visits[<span class="st">'purchased'</span>]][<span class="st">'customer_id'</span>].unique())<span class="sc">}</span><span class="ss"> users that have made a purchase."</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"This represents </span><span class="sc">{</span><span class="bu">len</span>(visits[visits[<span class="st">'purchased'</span>]][<span class="st">'customer_id'</span>].unique()) <span class="op">/</span> <span class="bu">len</span>(visits[<span class="st">'customer_id'</span>].unique()) <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">% of the total users."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 74774 users that have made a purchase.
This represents 54.91% of the total users.</code></pre>
</div>
</div>
<div id="cell-104" class="cell" data-execution_count="966">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># group by customer_id and visit_date, and count the number of visits</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>visits_per_day <span class="op">=</span> visits.groupby([<span class="st">'customer_id'</span>, visits[<span class="st">'start_timestamp'</span>].dt.date]).size()</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to get only the users who visited more than once on the same day</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>multiple_visits_per_day <span class="op">=</span> visits_per_day[visits_per_day <span class="op">&gt;</span> <span class="dv">1</span>]</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span>multiple_visits_per_day<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> instances of users visiting more than once on the same day."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 5642 instances of users visiting more than once on the same day.</code></pre>
</div>
</div>
</section>
<section id="avarage-user-review" class="level4">
<h4 class="anchored" data-anchor-id="avarage-user-review">Avarage user review</h4>
<div id="cell-106" class="cell" data-execution_count="967">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>review_data <span class="op">=</span> visits[visits[<span class="st">'user_review'</span>].notna()]</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>review_data[<span class="st">'month_year_num'</span>] <span class="op">=</span> review_data[<span class="st">'month_year'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.year <span class="op">*</span> <span class="dv">12</span> <span class="op">+</span> x.month)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>plt.hexbin(review_data[<span class="st">'month_year_num'</span>], review_data[<span class="st">'user_review'</span>], gridsize<span class="op">=</span><span class="dv">50</span>, cmap<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="co"># trend line</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>sns.regplot(data<span class="op">=</span>review_data, x<span class="op">=</span><span class="st">'month_year_num'</span>, y<span class="op">=</span><span class="st">'user_review'</span>, scatter<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Month-Year'</span>)</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'User Review'</span>)</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'User Reviews by Month-Year'</span>)</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">'Count'</span>)</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">75</span>)</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> review_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\gabri\AppData\Local\Temp\ipykernel_19400\108094133.py:2: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  review_data['month_year_num'] = review_data['month_year'].apply(lambda x: x.year * 12 + x.month)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-64-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-107" class="cell" data-execution_count="968">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the user_review group by month and year</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histogram</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>monthly_review <span class="op">=</span> visits.groupby(visits[<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>))[<span class="st">'user_review'</span>].mean()</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>ax.bar(monthly_review.index.astype(<span class="bu">str</span>), monthly_review.values, color<span class="op">=</span><span class="st">'lightblue'</span>, alpha<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot a line for every platform</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> platform <span class="kw">in</span> visits[<span class="st">'platform'</span>].unique():</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>    monthly_review <span class="op">=</span> visits[visits[<span class="st">'platform'</span>] <span class="op">==</span> platform].groupby(visits[<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>))[<span class="st">'user_review'</span>].mean()</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(monthly_review.index.astype(<span class="bu">str</span>), monthly_review.values, label<span class="op">=</span>platform)</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="co"># set the labels and title</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Month-Year'</span>)</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Average User Review'</span>)</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Monthly Average User Review'</span>)</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a><span class="co"># rotate x-axis labels for better readability</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">75</span>)</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a><span class="co"># show a grid</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a><span class="co"># add a legend</span></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a><span class="co"># show the plot</span></span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-65-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The avarage pattern here is really strange, but the trend is still positive</p>
<p>We can see that there’s something strange arrount the Q3 (probably the website was in beta or something similar)</p>
<p>To investigate more the Dealership problem we can try with the correlation.</p>
</section>
<section id="monthly-purchases" class="level4">
<h4 class="anchored" data-anchor-id="monthly-purchases">Monthly Purchases</h4>
<div id="cell-110" class="cell" data-execution_count="969">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the number of purchases by month and year</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histogram</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>monthly_purchases <span class="op">=</span> visits[visits[<span class="st">'purchased'</span>]].groupby(visits[<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>)).size()</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>ax.bar(monthly_purchases.index.astype(<span class="bu">str</span>), monthly_purchases.values, color<span class="op">=</span><span class="st">'lightblue'</span>, alpha<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot a line for every platform</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> platform <span class="kw">in</span> visits[<span class="st">'platform'</span>].unique():</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>    monthly_purchases <span class="op">=</span> visits[(visits[<span class="st">'platform'</span>] <span class="op">==</span> platform) <span class="op">&amp;</span> visits[<span class="st">'purchased'</span>]].groupby(visits[<span class="st">'start_timestamp'</span>].dt.to_period(<span class="st">'M'</span>)).size()</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(monthly_purchases.index.astype(<span class="bu">str</span>), monthly_purchases.values, label<span class="op">=</span>platform)</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a><span class="co"># set the labels and title</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Month-Year'</span>)</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Number of Purchases'</span>)</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Monthly Purchases'</span>)</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="co"># rotate x-axis labels for better readability</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">75</span>)</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a><span class="co"># show a grid</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a><span class="co"># add a legend</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a><span class="co"># show the plot</span></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="%5BSTEP%202.4%5D%20Visits%20EDA_files/figure-html/cell-66-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>‘visit_id’, ‘customer_id’, ‘start_timestamp’, ‘end_timestamp’, ‘visit_type’, ‘transaction_id’, ‘visit_duration_time’, ‘user_first_name’, ‘user_last_name’, ‘gender’, ‘email’, ‘email_domain’, ‘purchase’, ‘platform’, ‘purchase_date’, ‘purchase_price’, ‘user_review’, ‘car_model’, ‘fuel_type’, ‘release_date’, ‘price’, ‘discount’, ‘car_age_days’, ‘average_visit_time’, ‘visit_number’, ‘visit_date’</p>
<div id="cell-112" class="cell" data-execution_count="970">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save the data</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>visits.to_csv(<span class="st">'Modified_Data/visits.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>